<!DOCTYPE html>
<html lang = "en">
<head>
  <meta charset = "UTF-8">
  <link rel = "stylesheet" href="style.css">
  <title> DNSpyr </title>
</head>
<body>
    <header>
      <h1>DNSSpyr</h1>
    </header>
    <div name="lookupResultsList" id="lookupResultsList">
    </div>
    <div name="advLookupResultsList" id="advLookupResultsList">
      <p name="advLookupResult" id="advLookupResult"></p>
    </div>
    <div id="mainview" name="mainview">
      <form action="/add" method="POST">
        <fieldset>
          <h3>Add a new DNS Server</h3>
          <label for="dnsIP">Server IP Address</label>
          <input type="text" id='dnsIP' name="dnsIP">
          <br><br>
          <button type="reset">Reset</button>
          <button type="submit">Submit</button>
          <label>Clear DNS Server List</label>
          <input type="checkbox" id="clear" name="clear">
        </fieldset>
      </form>
      <form action="/lookup" method="POST">
          <fieldset>
            <h3>Simple DNS Lookup</h3>
            <label>Hostname</label>
            <input type="text" id="hostname" name="hostname" required>
            <br><br>
            <button type ="reset">Reset</button>
            <button type ="submit">Submit</button>
            <br><br><br>
          </fieldset>
        </form>
        <form action="/adv_lookup" method="POST">
          <fieldset>
            <h3>Advanced DNS Lookup</h3>
            <label for="hostname">Hostname</label>
            <input type="text" id="hostname" name="hostname" required>
            <label for="recordType">Record Type</label>
            <select name="recordType" id="recordType">
              <option value="A" selected="selected">A</option>
              <option value="AAAA">AAAA</option>
              <option value="MX">MX</option>
              <option value="NS">NS</option>
              <option value="ANY">ANY</option>
            </select>
            <br><br>
            <button type="reset">Reset</button>
            <button type="submit">Submit</button>
            <br><br><br>
            <p name="resolveResult" id="resolveResult"></p>
          </fieldset>
        </form>
      </div>
      <footer>
        <hr>
        <h4>Please enter the IP address of a DNS server to perform targeted (advanced) lookups, DNSpyr will use the DNS server you specified if you have not specified a DNS server please use "Simple DNS Lookup"</h4>
      </footer>
    <script>
        fetch('/fetchLookupHistory')
        .then(response => response.json())
        .then(json => {
            var result = JSON.stringify(json);
            console.log(result);
            var object = JSON.parse('{"lookups":['+result.substring(1, result.length-1)+']}');     
            console.log(object.lookups.length);
            console.log(object.lookups[0].hostname)
            console.log(object.lookups[0].addr4)

            element = document.getElementById("lookupResultsList");
            for (var result = 0; result < object.lookups.length; result++){
              var para = document.createElement("p");
              var node = document.createTextNode(object.lookups[result].hostname +": " + object.lookups[result].addr4);
              para.appendChild(node);
              element.appendChild(para);
            }
        });
    </script>
    <script>
      fetch('/fetchLookupResults')
        .then(response => response.json())
        .then(json => {
            var result = JSON.stringify(json);
            var object = JSON.parse('{"lookups":['+result.substring(1, result.length-1)+']}'); 
            console.log(object.lookups[0].address)
        });
    </script>
</body>
</html>

    